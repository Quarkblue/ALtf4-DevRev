version: "2"

name: Smart Ticket routing
description: "This is a sample manifest for Smart Ticket routing. updated for dev and works"

service_account:
  display_name: "ticket-bot"

event_sources:
  organization:
    - name: ticket-bot-webhook
      type: devrev-webhook
      description: webhook for work, devusers updates
      config:
        event_types:
          - work_created
          - work_updated
          - dev_user_created
          - dev_user_updated

functions:
  - name: ticketRouteOn_WorkCreated
    description: Function to handle ticket routing on work creation

  - name: Initialize
    description: Function to initialize the ticket routing
  
  - name: refreshDataContext
    description: Function to refresh the data context for ticket routing

automations:
  - name: TicketRoute-on-WorkCreated-automation
    source: ticket-bot-webhook
    event_types:
      - work_created
      - work_updated
      - dev_user_created
      - dev_user_updated
    function: ticketRouteOn_WorkCreated

commands:
  - name: RefreshData
    namespace: ticket_bot
    description: refresh the data stored for ticker routing in the bot
    surfaces:
      - surface: discussions
        object_types:
          - snap_in
    function: refreshDataContext
  
  - name: ReInitialize
    namespace: ticket_bot
    description: Re-Initializes the ticket routing bot
    surfaces:
      - surface: discussions
        object_types:
          - snap_in
    function: Initialize

hooks:
  - type: activate
    function: Initialize